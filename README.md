This is a demo script for the Universal Resolver DIDComm agent interface (see https://github.com/danubetech/universal-resolver-didcomm).

# Overview

The demo script will invoke a client DIDComm agent, which will in turn open a connection to a Universal Resolver DIDComm agent for a DID resolution request.

The demo script requires a DIDComm connection invitation generated by the Universal Resolver DIDComm agent.

The demo script is marked in red in the following diagram:

![architecture-demo-script](https://raw.githubusercontent.com/danubetech/universal-resolver-didcomm-demo/main/diagrams/architecture-demo-script.png)

Then start two agents, acting as a server and a client (in a separate shell after activating the virtualenv again):
```
# server
aca-py start -it http 127.0.0.1 3555 -ot http --auto-accept-invites --auto-accept-requests --endpoint http://127.0.0.1:3555 --auto-respond-messages --label Server --log-level debug --public-invite --invite --invite-base-url http://localhost:3555 --invite-multi-use --no-ledger --admin-insecure-mode --admin 127.0.0.1 3000 --write-invitation-to=~/didcomm-invitation.txt --emit-new-didcomm-prefix --plugin resolve_did --seed 0123456789ABCDEF0123456789ABCDEF
# docker server (image built with aries-cloudagent-container), listening on and mapping port 3555:
docker run --net=host -p 3000:3000 -p 3555:3555 -i -t universalresolver/universal-resolver-didcomm-demo:latest start --admin-insecure-mode --admin 0.0.0.0 3000 -it http 0.0.0.0 3555 -ot http --auto-accept-invites --auto-accept-requests --endpoint http://127.0.0.1:3555 --auto-respond-messages --label Server --log-level debug  --public-invite --invite --invite-base-url http://localhost:8080 --no-ledger --emit-new-didcomm-prefix

# Run the demo script

First, make sure that you have both a client DIDComm agent and a Universal Resolver DIDComm agent you can use for the demo script (see https://github.com/hyperledger/aries-cloudagent-python/).

# client (will execute the didcomm queries)
aca-py start --admin-insecure-mode --admin 127.0.0.1 4000 -it http 127.0.0.1 4555 -ot http --auto-accept-invites --auto-accept-requests --endpoint http://127.0.0.1:4555 --auto-store-credential --auto-respond-messages --label Client --auto-ping-connection --log-level debug --no-ledger --emit-new-didcomm-prefix --plugin resolve_did
# docker client
docker run --net=host -p 4000:4000 -p 4555:4555 -i -t universalresolver/universal-resolver-didcomm-demo:latest start --admin-insecure-mode --admin 0.0.0.0 4000 -it http 0.0.0.0 4555 -ot http --auto-accept-invites --auto-accept-requests --endpoint http://127.0.0.1:4555 --auto-store-credential --auto-respond-messages --label Client --auto-ping-connection --log-level debug --no-ledger --emit-new-didcomm-prefix
```

Run `resolve_did.py` to connect the client DIDComm agent to the Universal Resolver DIDComm agent, and then instruct the client DIDComm agent to send a DID resolution request.

```
python3 resolve_did.py --invitation-path=~/didcomm-invitation.txt
# alternatively, use the base64 encoded invitation directly:
python3 resolve_did.py --invitation=eyJAdHlw...
```

In the log of the Universal Resolver DIDComm agent you should see the DID resolution request arriving,
and on the client DIDComm agent you should then see the resolved DID document from the DIDComm
message.

